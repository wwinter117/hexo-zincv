---
title: jvm-解析流程
tags:
  - jvm
date: 2022-8-3 22:46:49
---

参考 `java` 虚拟机规范：`5. Loading, Linking, and Initializing`

`java` 编译器将 `.java` 源文件编译成 `.class` 文件时，并不会直接将类中的字段或方法等直接编译成内存中的地址，而是使用符号引用来暂时代替，并且符号引用是用类的全限定类型、方法名和字段名等形式存在，比如下面的代码片段中：

```java
String str = "hi";
System.out.println(str);
```

其中的 `String` 类和 `println` 方法会被编译成：`java/lang/String` 和 `java/io/PrintStream.println`；而类加载过程中的解析阶段会将这些符号引用替换为实际的内存地址

解析主要分为四种类型：类或接口解析、字段解析、方法解析和接口方法解析。

### 1. 类或接口的解析

 **符号引用**：在字节码中，类和接口是通过符号引用来表示的（例如，通过类的全限定名，如`java/lang/String`）。

 **解析步骤**：类加载器会使用符号引用去寻找相应的类或接口定义，并将其解析为具体的类对象。

**过程**：
    1. 首先，`JVM` 会通过当前类的类加载器找到对应的符号引用（通常是类的全限定名）。
    2. `JVM` 会调用类加载器的`loadClass`方法来加载该类。
    3. 如果成功找到并加载该类或接口，则解析成功。
    4. 如果加载失败，则抛出`ClassNotFoundException`或`NoClassDefFoundError`异常。

### 2. 字段解析

**符号引用**：在字节码中，类的字段也是通过符号引用来表示的（例如，`cn/wwinter/MyClass.myField`）。

**解析步骤**：当解析字段时，首先需要解析它所在的类或接口。

**过程**：
    1. 首先，`JVM` 解析字段所在的类或接口。如果类或接口的解析失败，则抛出异常。
    2. 如果类解析成功，`JVM` 会查找该字段是否在类或接口中定义。
    3. 如果字段在该类或其父类中找到，解析成功。
    4. 如果字段未找到，则抛出 `NoSuchFieldError` 异常。

### 3. 方法解析

**符号引用**：在字节码中，方法调用是通过符号引用来表示的（例如，`cn/wwinter/MyClass.myMethod()`）。

**解析步骤**：解析方法的过程与解析字段类似，但要考虑方法的重载与继承。

**过程**：
    1. 首先，解析方法所在的类或接口。
    2. 然后，查找该方法在类或接口中是否存在，并确保方法签名匹配。
    3. 如果找到匹配的方法，则解析成功。
    4. 如果方法未找到或签名不匹配，则抛出`NoSuchMethodError`异常。

### 4. 接口方法解析

**符号引用**：接口方法的调用也是通过符号引用表示的，通常是指通过`invokeinterface`字节码指令来调用接口中的方法。

**解析步骤**：与普通方法解析类似，但是接口方法解析更复杂一些，因为需要考虑多个实现类。

**过程**：
    1. 首先解析接口。
    2. 然后，查找接口中声明的方法。如果接口解析成功并找到方法，则解析成功。
    3. 如果方法未找到，则抛出`AbstractMethodError`异常。

