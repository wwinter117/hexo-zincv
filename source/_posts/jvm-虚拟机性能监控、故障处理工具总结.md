---
title: jvm-虚拟机性能监控、故障处理工具总结
tags:
  - jvm
date: 2022-8-20 22:46:49
---

| 工具           | 功能描述                                    | 常用选项/命令                                             |
| ------------ | --------------------------------------- | --------------------------------------------------- |
| `jps`        | 列出所有正在运行的 `JVM` 进程及其启动类名或 `JAR` 文件名。    | `-v` 显示传递给 `JVM` 的参数<br>`-m` 显示传递给主类的参数             |
| `jstat`      | 监控 `JVM` 性能统计信息，如垃圾回收、类加载等。             | `-gc` 查看垃圾回收统计信息<br>`-class` 查看类加载信息                |
| `jmap`       | 生成堆转储文件，查看堆内存的使用情况。                     | `-dump` 生成堆转储<br>`-heap` 查看堆内存摘要<br>`-histo` 显示堆直方图 |
| `jstack`     | 打印线程的堆栈跟踪信息，用于诊断线程问题。                   | `-F` 强制输出线程堆栈跟踪<br>`-l` 输出附加的锁信息                    |
| `jinfo`      | 查看和调整正在运行的 `JVM` 实例的配置信息。               | `-flags` 查看所有 `JVM` 标志<br>`-sysprops` 查看系统属性        |
| `jcmd`       | 综合性工具，用于执行各种 `JVM` 诊断命令。                | `VM.uptime` 查看 `JVM` 的运行时间<br>`GC.run` 触发垃圾回收       |
| `jhat`       | 用于分析 `jmap` 生成的堆转储文件的工具，提供一个 `Web` 界面。  | `jhat <heap-dump-file>` 启动分析堆转储文件                   |
| `jdb`        | `Java` 调试器，用于调试 `Java` 程序。              | `stop at` 在指定类的行设置断点<br>`print` 打印变量值               |
| `jrunscript` | 运行脚本和执行命令行 `JavaScript` 程序。             | `-e` 执行命令<br>`-f` 执行脚本文件                            |
| `javap`      | 反编译 `Java` 类文件，显示类的字节码和结构。              | `-c` 反汇编代码<br>`-v` 显示详细的字节码信息                       |
| `jconsole`   | 基于 `GUI` 的工具，用于监控和管理 `JVM` 实例。          | 启动后选择目标 `JVM` 实例并查看各项性能指标                           |
| `jvisualvm`  | 综合性的 `GUI` 工具，用于分析、监控、故障排除和配置 `JVM` 应用。 | 启动后选择目标 `JVM` 实例并分析内存、`CPU` 使用情况等                   |
| `jstatd`     | 远程监控工具，用于提供 `jstat` 远程访问的支持。            | 启动守护进程以允许远程 `JVM` 监控                                |
| `hs_err_pid` | `JVM` 崩溃时自动生成的错误日志文件。                   | 分析文件中的堆栈跟踪和 `JVM` 错误信息                              |
| `jhsdb`      | 诊断和分析工具，用于分析 `JVM` 进程的堆、线程等信息。          | `jhsdb jmap` 查看堆信息或生成堆转储<br>`jhsdb jstack` 查看线程堆栈   |

## jps

`jps`  是一个用于列出当前所有运行中的 Java 虚拟机进程的命令行工具。它可以显示每个 `JVM` 实例的进程 `ID` (`PID`) 及其启动类或 `JAR` 文件名称，适用于快速获取 `JVM` 进程的 `PID`，以便与其他 `JVM` 工具（如  `jstat`,  `jstack`  等）结合使用。

### 基本用法

```bash
jps [options] [hostid]
```

- `[options]`:  `jps`  的选项，可以指定显示的内容。
- `[hostid]`: 可选参数，指定远程主机的标识符。如果未指定，则默认为本地主机。

### 常用选项

- `-q`  : 只输出 Java 进程的 PID，不显示类名、JAR 文件名等信息。
- `-m`  : 显示传递给主类的参数或传递给 JAR 文件的参数。
- `-l`  : 输出主类的全限定名或 JAR 文件的完整路径。
- `-v`  : 输出传递给 JVM 的参数。

## jstat

`jstat`  是一个用于监控 `JVM` 性能统计的命令行工具，它可以提供堆内存使用情况、垃圾收集信息、类加载统计等信息。以下是  `jstat`  的基本用法和常用选项说明：

### 基本用法

`jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]`

- `<option>`: 选择想要查看的统计信息类型，具体的选项可以通过  `jstat -options`  查看。
- `<vmid>`: `JVM` 实例的标识符，通常是 `JVM` 进程的 `PID`，也可以是  `<lvmid>@<hostname>[:<port>]`  的形式。
- `<interval>`: 采样间隔时间，可以指定单位为毫秒 (`ms`) 或秒 (`s`)，如果不指定单位，默认单位是毫秒。
- `<count>`: 采样次数，指定后程序在采样指定次数后自动终止。

### 常用选项

- `-gc`: 显示与垃圾回收相关的统计信息，包括年轻代、老年代、永久代的内存使用情况以及 `GC` 次数和时间。
- `-gccapacity`: 显示各代内存区域的使用和分配情况。
- `-gcutil`: 显示每一代内存区域的利用率以及 `GC` 的次数和时间。
- `-class`: 显示类加载的统计信息，包括已加载类、已卸载类的数量等。
- `-compiler`: 显示 `JIT` 编译器的统计信息。
- `-printcompilation`: 显示已经编译的最近方法的相关信息。

### 示例

1. 查看 `PID` 为 `12345` 的 `JVM` 的垃圾回收情况，每 `1` 秒采样一次，共采样 `10`次：
    
    `jstat -gc 12345 1000 10`
    
2. 查看 `JVM` 进程的类加载情况：
    
    `jstat -class 12345`
    
3. 查看 `PID` 为 `12345` 的 `JVM` 的堆内存使用情况，采样间隔为 `2` 秒，直到手动终止：
    
    `jstat -gcutil 12345 2000`
    
通过  `jstat`，可以对 `Java` 应用的运行状况进行实时监控和诊断，特别是在调优 `JVM` 参数时，这个工具非常有用。

## jinfo

`jinfo`  是一个用于查看和修改运行中 `Java` 虚拟机（`JVM`）进程配置的命令行工具。它可以用于查询 `JVM` 的启动参数、系统属性以及动态调整 `JVM` 的某些配置。

### 基本用法

`jinfo <option> <pid>`

- `<option>`: 要执行的操作选项，用于指定查询或设置的内容。
- `<pid>`: 目标 `JVM` 进程的 `PID`，用于指定要操作的 `JVM` 进程。

### 常用选项

- `-flag <name>`: 输出指定 `JVM` 标志（`flag`）的值。
- `-flag [+|-]<name>`: 启用或禁用指定的 `JVM` 标志。
- `-flag <name>=<value>`: 将指定的 `JVM` 标志设置为给定的值。
- `-flags`: 输出当前 `JVM` 进程的所有 `JVM` 标志及其值。
- `-sysprops`: 输出当前 `JVM` 进程的所有系统属性（`System Properties`）。
- `<no option>`: 如果不指定任何选项，则输出 `JVM` 的所有标志和系统属性。
- `-? | -h | --help | -help`: 输出帮助信息。
### 示例

1. **查看 JVM 标志的值**:
    
    `jinfo -flag MaxHeapSize 12345`
    
    这将输出 PID 为  `12345`  的 `JVM` 进程中  `MaxHeapSize`  标志的值。
    
2. **启用或禁用 JVM 标志**:
    
    `jinfo -flag +PrintGC 12345`
    
    这将启用 `PID` 为  `12345`  的 `JVM` 进程的  `PrintGC`  标志。
    
3. **设置 JVM 标志的值**:
    
    `jinfo -flag MaxHeapSize=1073741824 12345`
    
    这将把 `PID` 为  `12345`  的 `JVM` 进程的  `MaxHeapSize`  标志设置为 `1` GB（`1073741824` 字节）。
    
4. **查看所有 JVM 标志**:
    
    `jinfo -flags 12345`
    
    这将输出 `PID` 为  `12345`  的 `JVM` 进程的所有 `JVM` 标志及其当前值。
    
5. **查看所有系统属性**:
    
    `jinfo -sysprops 12345`
    
    这将输出 `PID` 为  `12345`  的 `JVM` 进程的所有系统属性。
    
6. **查看 JVM 标志和系统属性**:
    
    `jinfo 12345`
    
    如果不带任何选项，`jinfo`  会输出指定 `JVM` 进程的所有 `JVM` 标志和系统属性。

### 总结

`jinfo`  是一个非常有用的工具，特别是在需要诊断运行中的 `JVM` 进程问题时，可以让你动态地查看和调整 `JVM` 配置，而无需重启应用程序。

## jmap

`jmap`  是一个用于生成堆转储（`heap dump`）以及获取 `Java` 堆内存使用情况的命令行工具。它可以帮助分析 `JVM` 中对象的分配情况，了解内存使用的分布，并识别内存泄漏问题。

（`JDK 9` 及更高版本中用于替代  `jmap`  某些功能的新工具，可以使用  `jhsdb`  工具）

### 基本用法

`jmap [option] <pid>`

- `<option>`: 执行的操作选项，用于指定要获取的内存信息或生成的转储类型。
- `<pid>`: 目标 `JVM` 进程的 `PID`（进程 `ID`），用于指定要操作的 `JVM` 进程。

### 常用选项

- `-dump:[live,]format=b,file=<filename>`: 生成堆转储文件，`live`  表示只转储存活的对象（可选），`format=b`  表示二进制格式，`file=<filename>`  指定转储文件的路径和名称。
- `-heap`: 显示堆的概要信息，包括使用的堆存储管理器和堆配置。
- `-histo[:live]`: 显示堆中对象的直方图，包括类的实例数和占用空间。如果使用  `live`  选项，则只显示存活的对象。
- `-finalizerinfo`: 显示正在等待终结的对象（即  `finalize()`  尚未执行的对象）。
- `-clstats`: 显示类加载器的统计信息。
- `-F`: 强制操作，当 `JVM` 不响应时（例如挂起状态），可以使用这个选项强制生成堆转储或获取内存信息。
- `-J<flag>`: 将  `<flag>`  直接传递给 `JVM`（与其他工具相同的选项）。

### 示例

1. **生成堆转储文件**:
    
    `jmap -dump:format=b,file=heapdump.hprof 12345`
    
    这将在当前目录下生成名为  `heapdump.hprof`  的堆转储文件，适用于分析内存泄漏或内存使用情况。
    
2. **只转储存活对象**:
    
    `jmap -dump:live,format=b,file=heapdump_live.hprof 12345`
    
    这将生成一个仅包含存活对象的堆转储文件。
    
3. **查看堆的概要信息**:
    
    `jmap -heap 12345`
    
    这将显示 `JVM` 堆的概要信息，包括堆的配置和使用情况。
    
4. **显示堆中对象的直方图**:
    
    `jmap -histo 12345`
    
    这将显示所有对象的直方图，包括每个类的实例数量和总占用空间。
    
5. **显示仅存活对象的直方图**:
    
    `jmap -histo:live 12345`
    
    这将显示堆中仅存活对象的直方图。
    
6. **显示正在等待终结的对象**:
    
    `jmap -finalizerinfo 12345`
    
    这将列出 `JVM` 中正在等待执行  `finalize()`  方法的对象。

### 总结

`jmap`  是 `JVM` 诊断和内存分析的重要工具，尤其在分析内存泄漏、内存分配模式和优化内存使用时非常有用。它可以帮助生成堆转储，查看内存使用情况，并获取 `JVM` 的详细内存统计信息，从而深入了解 `Java` 应用的内存表现。